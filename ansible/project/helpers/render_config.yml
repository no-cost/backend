---
# renders etc/config.json for the tenant
# must run AFTER copy_structure.yml (rsync overwrites etc/ perms)

- name: Ensure etc directory exists
  ansible.builtin.file:
      path: "{{ paths.tenants.root }}/{{ tenant_tag }}/etc"
      state: directory
      owner: "tenant_{{ tenant_tag }}"
      group: "tenant_{{ tenant_tag }}"
      mode: "755"
  tags: [always]

- name: Render config.json template with tenant information
  ansible.builtin.template:
      src: "{{ playbook_dir }}/files/srv/skeleton/etc/config.json"
      dest: "{{ paths.tenants.root }}/{{ tenant_tag }}/etc/config.json"
      owner: "tenant_{{ tenant_tag }}"
      group: "tenant_{{ tenant_tag }}"
      mode: "640"
  tags: [always]
