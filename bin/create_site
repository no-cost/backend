#!/usr/bin/env python3
import argparse
import asyncio
import secrets
import sys

from site_manager import create_site


def main():
    parser = argparse.ArgumentParser(description="Create a new tenant site")
    parser.add_argument("tenant_tag", help="Unique 4-character identifier")
    parser.add_argument(
        "service_type",
        choices=["flarum", "mediawiki", "wordpress"],
        help="Type of site to create",
    )
    parser.add_argument("admin_email", help="Administrator email address")
    parser.add_argument(
        "--password",
        help="Admin password (generated if not provided)",
        default=None,
    )

    args = parser.parse_args()

    # Generate password if not provided
    password = args.password or secrets.token_urlsafe(16)

    try:
        asyncio.run(
            create_site(
                tenant_tag=args.tenant_tag,
                service_type=args.service_type,
                admin_email=args.admin_email,
                admin_password=password,
            )
        )
        print(f"Site created successfully: {args.tenant_tag}")
        if not args.password:
            print(f"Generated admin password: {password}")
    except Exception as e:
        print(f"Error creating site: {e}", file=sys.stderr)
        sys.exit(1)


if __name__ == "__main__":
    main()
